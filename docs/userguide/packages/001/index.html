<!DOCTYPE html>
<html lang="en-us">

<head>
  <link rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
  integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk="
  crossorigin="anonymous" />


  
  <meta charset="utf-8">



<meta name="viewport" content="width=device-width, initial-scale=1.0">


  
    <meta name="description" content="bmstack is part of BondMachine project. Within the project It is used to create stacks and queues distributed among several BondMachine cores. due to its generality it can also be used as standalone tool to produce HDL shared stacks and queues to be used in other projects. The HDL code is build using golang templates that creates the code starting from the following data structure. The comments describe the meaning of each field.">
  


<meta name="color-scheme" content="light dark">







<meta name="generator" content="Hugo 0.126.1">
  <title>bmstack | BondMachine</title>
  <link rel="canonical" href="https://bondmachinehq.github.io/docs/userguide/packages/001/">




  








  
    
    
  
  
      <link rel="stylesheet" href="/css/base.min.8e67dbf71c26d0a6dbf4662f796d909952715e54bce477c632a31f634032185f.min.8e67dbf71c26d0a6dbf4662f796d909952715e54bce477c632a31f634032185f.css" integrity="sha256-jmfb9xwm0Kbb9GYveW2QmVJxXlS85HfGMqMfY0AyGF8=" crossorigin="anonymous">

      <link rel="stylesheet" href="/css/syntax.min.065df42d2be658bb8e0720297aadf469355a5ffaf863b00e3cce0627dd106ca0.css" integrity="sha256-Bl30LSvmWLuOByApeq30aTVaX/r4Y7AOPM4GJ90QbKA=" crossorigin="anonymous">



</head>

<body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/js/all.min.js"
          integrity="sha256-MAgcygDRahs+F/Nk5Vz387whB4kSK9NXlDN3w58LLq0="
          crossorigin="anonymous"></script>

  <nav class="u-background">
  <div class="u-wrapper">
    <ul class="Banner">
      <li class="Banner-item Banner-item--title">
        <a class="Banner-link u-clickable" href="/">BondMachine</a>
        <a class="Banner-link u-clickable" href="/tags"><i class="fa fa-tags"></i></a>
        </li>
      
        
        
        <li class="Banner-item">
          <a class="Banner-link u-clickable" href="/intro/">Intro</a>
        </li>
      
        
        
        <li class="Banner-item">
          <a class="Banner-link u-clickable" href="/posts/">News</a>
        </li>
      
        
        
        <li class="Banner-item">
          <a class="Banner-link u-clickable" href="/docs/">Docs</a>
        </li>
      
        
        
        <li class="Banner-item">
          <a class="Banner-link u-clickable" href="/prototypes/">Prototypes</a>
        </li>
      
        
        
        <li class="Banner-item">
          <a class="Banner-link u-clickable" href="/examples/">Examples</a>
        </li>
      
        
        
        <li class="Banner-item">
          <a class="Banner-link u-clickable" href="/media/">Media</a>
        </li>
      
        
        
        <li class="Banner-item">
          <a class="Banner-link u-clickable" href="/about/">About</a>
        </li>
      
    </ul>
  </div>
</nav>

  
<nav class="u-background">
  <div class="u-wrapper">
    <ul class="Banner">
      
        <li class="Banner-item Banner-item--title">
          <a class="Banner-link u-clickable" href=".." style="color: red;">&crarr;packages</a>
        </li>
      
      <li class="Banner-item Banner-item--title">
        <a class="Banner-link u-clickable"></a>
      </li>
      
    </ul>
  </div>
</nav>


  <main>
    <div class="u-wrapper">
      <div class="u-padding">
        

  <header class="Heading">
  <h1 class="Heading-title">
    <a class="Heading-link u-clickable" href="/docs/userguide/packages/001/" rel="bookmark">bmstack</a>
  </h1>
  
</header>
  
    <hr>
<p>bmstack is part of BondMachine project. Within the project It is used to create stacks and queues distributed among several BondMachine cores. due to its generality it can also be used as standalone tool to produce HDL shared stacks and queues to be used in other projects.
The HDL code is build using golang templates that creates the code starting from the following data structure. The comments describe the meaning of each field.</p>

  

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Push</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Agent</span> <span class="kt">string</span> <span class="c1">// The name of the agent that is pushing
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">Tick</span>  <span class="kt">uint64</span> <span class="c1">// The tick at which the push occurs
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">Value</span> <span class="kt">string</span> <span class="c1">// The value that is pushed
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Pop</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Agent</span> <span class="kt">string</span> <span class="c1">// The name of the agent that is popping
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">Tick</span>  <span class="kt">uint64</span> <span class="c1">// The tick at which the pop occurs
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">TestBenchData</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Pops</span>         <span class="p">[]</span><span class="nx">Pop</span>    <span class="c1">// List of pops
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">Pushes</span>       <span class="p">[]</span><span class="nx">Push</span>   <span class="c1">// List of pushes
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">TestSequence</span> <span class="p">[]</span><span class="kt">string</span> <span class="c1">// Pushes and pops in order
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">BmStack</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ModuleName</span> <span class="kt">string</span>   <span class="c1">// The name of the module
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">DataSize</span>   <span class="kt">int</span>      <span class="c1">// The size of the data bus
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">Depth</span>      <span class="kt">int</span>      <span class="c1">// The depth of the stack
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">Senders</span>    <span class="p">[]</span><span class="kt">string</span> <span class="c1">// The names of the agents that can send data to the stack
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">Receivers</span>  <span class="p">[]</span><span class="kt">string</span> <span class="c1">// The names of the agents that can receive data from the stack
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">MemType</span>    <span class="kt">string</span>   <span class="c1">// &#34;LIFO&#34; for a stack or &#34;FIFO&#34; for a queue
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">funcMap</span>    <span class="nx">template</span><span class="p">.</span><span class="nx">FuncMap</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// TestBench data
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">TestBenchData</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>



<h2 id="api">
  <a class="Heading-link u-clickable" href="/docs/userguide/packages/001/#api">API</a>
</h2>
<p>The library can be used in two ways.
The first one is from a go program. After creating a BmStack structure, the user can call the WriteHDL function to produce the HDL code.
An example on how the library can be used this way can be seen in the go test file (bmstack_test.go).</p>

  

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestWriteHDL</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Create a new stack with 4 agents
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">stack</span> <span class="o">:=</span> <span class="nx">BmStack</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">ModuleName</span><span class="p">:</span> <span class="s">&#34;test&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">DataSize</span><span class="p">:</span>   <span class="mi">32</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Depth</span><span class="p">:</span>      <span class="mi">8</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Senders</span><span class="p">:</span>    <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;sender1&#34;</span><span class="p">,</span> <span class="s">&#34;sender2&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Receivers</span><span class="p">:</span>  <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;receiver1&#34;</span><span class="p">,</span> <span class="s">&#34;receiver2&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="nx">MemType</span><span class="p">:</span>    <span class="s">&#34;LIFO&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// write the HDL code
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">stack</span><span class="p">.</span><span class="nf">WriteHDL</span><span class="p">()</span></span></span></code></pre></div>
<p>The second part of the struct can be filled with test data. These data are used to produce a test bench for the stack. Using the test bench the user can verify the correctness of the stack. The test bench is produced by calling the WriteTestBench function.</p>

  

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestWriteTestBench</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">stack</span> <span class="o">:=</span> <span class="nx">BmStack</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">s</span><span class="p">.</span><span class="nx">Pushes</span> <span class="p">=</span> <span class="p">[]</span><span class="nx">Push</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">Push</span><span class="p">{</span><span class="s">&#34;sender1&#34;</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="s">&#34;32&#39;d1&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">s</span><span class="p">.</span><span class="nx">Pops</span> <span class="p">=</span> <span class="p">[]</span><span class="nx">Pop</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">Pop</span><span class="p">{</span><span class="s">&#34;receiver1&#34;</span><span class="p">,</span> <span class="mi">60</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// write the test bench
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">stack</span><span class="p">.</span><span class="nf">WriteTestBench</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
<p>The two functions (WriteHDL and WriteTestBench) return a string that contains the HDL code or an error if something went wrong (string, error).
The provided go test file (bmstack_test.go) shows how the library can be used in this way. When invoked (go test), it produces the two files (bmstack.v and bmstack_tb.v).</p>



<h2 id="cli">
  <a class="Heading-link u-clickable" href="/docs/userguide/packages/001/#cli">CLI</a>
</h2>
<p>the library also came with a companion CLI executable called bmstack that provides the basic interface to the library. This is the second Possible way to use it.</p>

  

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ bmstack -h
</span></span><span class="line"><span class="cl">Usage of bmstack:
</span></span><span class="line"><span class="cl">  -d    Verbose
</span></span><span class="line"><span class="cl">  -data-width int
</span></span><span class="line"><span class="cl">        Width of the data bus <span class="o">(</span>default 32<span class="o">)</span>
</span></span><span class="line"><span class="cl">  -depth int
</span></span><span class="line"><span class="cl">        Depth of the stack/queue <span class="o">(</span>default 8<span class="o">)</span>
</span></span><span class="line"><span class="cl">  -hdl-file string
</span></span><span class="line"><span class="cl">        Name of the file to write the HDL to <span class="o">(</span>empty string to disable<span class="o">)</span> <span class="o">(</span>default <span class="s2">&#34;stack.v&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  -memory-type string
</span></span><span class="line"><span class="cl">        Memory type, either stack or queue <span class="o">(</span>default <span class="s2">&#34;queue&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  -random-stimulus int
</span></span><span class="line"><span class="cl">        Generate random stimulus including N pushes and pops <span class="k">for</span> every agent <span class="o">(</span><span class="m">0</span> to disable<span class="o">)</span>
</span></span><span class="line"><span class="cl">  -receivers string
</span></span><span class="line"><span class="cl">        Comma separated list of names of signal tags that will receive data from the stack/queue
</span></span><span class="line"><span class="cl">  -senders string
</span></span><span class="line"><span class="cl">        Comma separated list of names of signal tags that will send data to the stack/queue
</span></span><span class="line"><span class="cl">  -sim-length int
</span></span><span class="line"><span class="cl">        Length of the simulation in clock cycles <span class="o">(</span>default 1000<span class="o">)</span>
</span></span><span class="line"><span class="cl">  -stimulus-file string
</span></span><span class="line"><span class="cl">        Name of the JSON file to load the stimulus from <span class="o">(</span>empty string to disable<span class="o">)</span>
</span></span><span class="line"><span class="cl">  -tb-file string
</span></span><span class="line"><span class="cl">        Name of the file to write the testbench to <span class="o">(</span>empty string to disable<span class="o">)</span>
</span></span><span class="line"><span class="cl">  -v    Verbose</span></span></code></pre></div>
<p>Examples of usage:</p>



<h2 id="simulation">
  <a class="Heading-link u-clickable" href="/docs/userguide/packages/001/#simulation">Simulation</a>
</h2>
<p>WIP</p>
<p>To see how the library is used in the BondMachine project, please refer to the BondMachine examples directory that contains many examples of BondMachines using stacks and queues.</p>

  

  

  





  
  
  



      </div>
    </div>
  </main>
  
  <footer class="Footer">
    <div class="u-wrapper">
      <div class="u-padding u-noboosting">
        The BondMachine Project - <a href="https://creativecommons.org/licenses/by/4.0/" rel="license">CC BY-SA 4.0</a>.
      </div>
    </div>
  </footer>

</body>

</html>
